// Import Third-party Dependencies
import * as vuln from "@nodesecure/vuln";
import * as i18n from "@nodesecure/i18n";
import ms from "ms";
import kleur from "kleur";
import { computeWithSpinner } from "@topcli/spinner";

// Import Internal Dependencies
import { taggedI18nString } from "../utils.js";

// CONSTANTS
const kSpinnerHydrateDatabase = taggedI18nString`${"cli.commands.hydrate_db.running"}`;

export async function hydrate() {
  const strategy = await vuln.setStrategy(vuln.strategies.SECURITY_WG, {
    hydrateDatabase: false
  });

  await strategy.deleteDatabase();

  const dbName = kleur.yellow().bold("nodejs security-wg");
  await computeWithSpinner(
    () => strategy.hydrateDatabase(),
    { text: kSpinnerHydrateDatabase([dbName]) },
    {
      fail: (err) => err.message,
      success: (elapsedTime) => kleur.white().bold(
        i18n.getToken("cli.commands.hydrate_db.success", kleur.cyan(ms(elapsedTime)))
      )
    }
  );
  console.log("");
}
